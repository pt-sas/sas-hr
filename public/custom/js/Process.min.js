function checkFixedColumns(){return $(".tb_display thead th").length>10?{rightColumns:1,leftColumns:0}:$(".tb_display thead th").length>15?{rightColumns:1,leftColumns:3}:void 0}function checkScrollX(){return $(".tb_display thead th").length>7}function checkScrollY(){return $(".tb_display thead th").length>10?"400px":""}function reloadTable(){$(".tb_display").length>0?_table.ajax.reload(null,!1):$(".table_report").length>0&&_tableReport.ajax.reload(null,!1)}function Edit(e,t,a){const n=$(".container"),i=n.find(".card-body"),o=n.find(".card-form");let s=o.find("form");const l=n.find(".main_page"),r=n.find(".modal-tab");let d,c=n.find(".card");ID=e;let f="update";void 0!==a&&""!==a||(a=LAST_URL);let m=isAccess(f,a);m[0].success&&"Y"==m[0].message?(c=c.length>1?n.find(".page-inner"):l.find(".card"),c.length&&(c.addClass("is-loading"),setTimeout(function(){if($.each(i,function(e,a){let s=a.className.split(/\s+/);if(i.length>1){if(s.includes("card-main")){$(this).css("display","none");const e=n.find(".page-header");ul=e.find("ul.breadcrumbs"),ul.find("li.nav-item > a").attr("href",CURRENT_URL);let a='<li class="separator"><i class="flaticon-right-arrow"></i></li>';a+=void 0===t||""===t||"DR"===t?'<li class="nav-item"><a class="text-primary font-weight-bold">Update</a></li>':'<li class="nav-item"><a class="text-primary font-weight-bold">Detail</a></li>',ul.append(a),n.find("div.filter_page").length>0&&n.find("div.filter_page").css("display","none")}if(s.includes("card-form")){const e=o.closest(".card"),t=e.find(".card-header");t.find("button","a").css("display","none"),$(this).css("display","block"),cardBtn.css("display","block"),d=$(this).prop("classList")}}}),r.length){let e=r.attr("id");$(`#${e}`).modal({backdrop:"static",keyboard:!1});const t=r.find("li.nav-item a"),a=r.find(".tab-pane.active");$.each(t,function(){this.classList.contains("active")||$(this).addClass("disabled")}),Scrollmodal(),s=a.find("form")}let a=CURRENT_URL+SHOW+ID;setSave=void 0===t||""===t||"DR"===t?"update":"detail",$.ajax({url:a,type:"GET",cache:!1,dataType:"JSON",beforeSend:function(){$(".save_form").attr("disabled",!0),$(".x_form").attr("disabled",!0),$(".close_form").attr("disabled",!0),loadingForm(s.prop("id"),"facebook")},complete:function(){void 0!==t&&""!==t&&"DR"!==t&&"IP"!==t||$(".save_form").removeAttr("disabled"),$(".x_form").removeAttr("disabled"),$(".close_form").removeAttr("disabled"),hideLoadingForm(s.prop("id"))},success:function(a){if(a[0].success){let n=a[0].message;if(n.line){let e=n.line;if(_tableLine.context.length){let a=JSON.parse(e);_tableLine.rows.add(a).draw(!1);let n=_tableLine.rows().nodes().to$().find("button");const i=_tableLine.rows().nodes().to$().find("input, select");"detail"===setSave&&"DR"!==t?($(".add_row, .create_line").css("display","none"),$.each(n,function(e,a){let n=a.className.split(/\s+/);n.includes("btn_accept")&&"IP"!==t&&$(this).css("display","none"),n.includes("btn_delete")&&$(this).css("display","none")}),$.each(i,function(e,a){const n=$(this).closest("tr"),i=a.className.split(/\s+/);i.includes("updatable")&&"IP"===t||("text"!==a.type?n.find("input:checkbox[name="+a.name+"], select[name="+a.name+"], input:radio[name="+a.name+"]").prop("disabled",!0):n.find("input:text[name="+a.name+"], textarea[name="+a.name+"]").prop("readonly",!0))})):($(".add_row, .create_line").css("display","block"),n.css("display","block"))}}if(n.role){let e=n.role;if(s.find("table.tb_tree").length>0)for(let t=0;t<e.length;t++){const a=s.find("table.tb_tree"),n=a.find("td input:checkbox");$.each(n,function(a,n){"parent"===$(n).attr("data-menu")?e[t].sys_menu_id==$(n).val()&&0==e[t].sys_submenu_id&&("Y"==e[t].isview&&"isview"===$(n).attr("name")||"Y"==e[t].iscreate&&"iscreate"===$(n).attr("name")||"Y"==e[t].isupdate&&"isupdate"===$(n).attr("name")||"Y"==e[t].isdelete&&"isdelete"===$(n).attr("name")?$(n).prop("checked",!0):$(n).prop("checked",!1),$(n).attr("id",e[t].sys_access_menu_id)):e[t].sys_submenu_id===$(n).val()&&("Y"==e[t].isview&&"isview"===$(n).attr("name")||"Y"==e[t].iscreate&&"iscreate"===$(n).attr("name")||"Y"==e[t].isupdate&&"isupdate"===$(n).attr("name")||"Y"==e[t].isdelete&&"isdelete"===$(n).attr("name")?$(n).prop("checked",!0):$(n).prop("checked",!1),$(n).attr("id",e[t].sys_access_menu_id))})}}if(n.header){let t=n.header;if(putFieldData(s,t),r.length){const t=r.find("li.nav-item a"),a=r.find(".tab-pane");$.each(t,function(){this.classList.contains("active")||$(this).removeClass("disabled")}),$.each(a,function(){const t=$(this).find("form");t.find("input.foreignkey").attr("set-id",e),$(this).prop("classList").contains("active")&&($(this).attr("set-save",setSave),$(this).attr("set-id",e))})}else for(let e=0;e<t.length;e++){let a=t[e].field,n=t[e].label;d.contains("modal")&&"title"===a?modalTitle.html(capitalize(n)):"title"===a&&cardTitle.html(capitalize(n))}}$("html, body").animate({scrollTop:$(".main-panel").offset().top},500)}else Toast.fire({type:"error",title:a[0].message})},error:function(e,t){showError(e,t)}}),c.removeClass("is-loading")},200))):m[0].success&&"N"==m[0].message?Toast.fire({type:"error",title:"You are role don't have permission, please reload !!"}):Toast.fire({type:"error",title:m[0].message})}function Destroy(e){let t=CURRENT_URL+DELETE+e,a="delete",n=isAccess(a,LAST_URL);n[0].success&&"Y"==n[0].message?Swal.fire({title:"Delete ?",text:"Are you sure you wish to delete the selected data ? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Ok",cancelButtonText:"Close",reverseButtons:!0}).then(e=>{e.value&&$.getJSON(t,function(e){e[0].success?(Swal.fire({title:"Deleted!",text:"Your data has been deleted.",type:"success",showConfirmButton:!1,timer:1e3}),reloadTable()):e[0].error?console.info(e):(Swal.fire({title:"Error!",text:e[0].message,type:"error",showConfirmButton:!0}),reloadTable())}).fail(function(e,t,a){console.info(a),reloadTable()})}):n[0].success&&"N"==n[0].message?Toast.fire({type:"error",title:"You are role don't have permission, please reload !!"}):Toast.fire({type:"error",title:n[0].message})}function getDocAction(e,t){let a=[];return $.ajax({type:"POST",url:ADMIN_URL+"docaction/getDocaction",data:{status:e,url:t},async:!1,cache:!1,dataType:"JSON",success:function(e){a.push(e)}}),a}function docProcess(e,t){let a="update",n=isAccess(a,LAST_URL);if(n[0].success&&"Y"==n[0].message){let a=getDocAction(t,LAST_URL),n='<div class="d-flex justify-content-center"><select id="docaction">';n+='<option value=""></option>',a[0].length>0&&$.each(a[0],function(e,t){n+=`<option value="${t.id}">${t.text}</option>`}),n+="</select></div>",Swal.fire({title:"Document Action",html:n,showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonText:"Ok",cancelButtonText:"Close",showLoaderOnConfirm:!0,reverseButtons:!0,onOpen:()=>{$("#docaction").select2({placeholder:"Select an option",width:"40%",theme:"bootstrap",dropdownAutoWidth:!0,allowClear:!0})},preConfirm:t=>new Promise(function(t){let a=$("#docaction option:selected").val(),n=CURRENT_URL+"/processIt?id="+e+"&docaction="+a;$.getJSON(n,function(e){e[0].success&&(1==e[0].message?Swal.fire({title:"Success !!",text:"Your data has been process",type:"success",showConfirmButton:!1,timer:1e3}):Swal.fire({title:"Error!",text:e[0].message,type:"error",showConfirmButton:!1,timer:1e3}),reloadTable()),(void 0!==e[0].error&&e[0].error||void 0!==e[0].error&&!e[0].error)&&(Swal.showValidationMessage(e[0].message),t(!1))}).fail(function(e,a,n){Swal.showValidationMessage(n),t(!1),reloadTable()})}),allowOutsideClick:()=>!Swal.isLoading()})}else n[0].success&&"N"==n[0].message?Toast.fire({type:"error",title:"You are role don't have permission, please reload !!"}):Toast.fire({type:"error",title:n[0].message})}function arrContains(e,t){var a=null;for(let i=0;i<t.length;i++){var n=t[i];if(n.toString().toLowerCase()===e.toString().toLowerCase()){a=n;break}}return a}function errorForm(e,t){const a=e.find("input, select, textarea").not(".line"),n=e.find("small");let i=[],o=[];for(let e=0;e<n.length;e++)""!==n[e].id&&o.push(n[e].id);for(let e=0;e<a.length;e++)i.push(a[e].name);for(let a=0;a<t.length;a++){let n=t[a].error,s=t[a].field,l=t[a].label,r=arrContains(n,o),d=arrContains(s,i);if(""!==l&&a>0){if("error_table"!==n&&(e.find("small[id="+r+"]").html(l),e.find("input:text[name="+d+"], select[name="+d+"], textarea[name="+d+"], input:password[name="+d+"]").not(".line").closest(".form-group").addClass("has-error")),_tableLine.context.length){"line"===s&&Toast.fire({type:"error",title:l});const e=_tableLine.rows().nodes().to$().find("input, select");let t=[];$.each(e,function(e){let a=this.value,i=$(this).attr("name"),o=$(this)[0].className.split(/\s+/),r=$(this).closest("tr")[0]._DT_RowIndex;if($(this).attr("required")){let e=Number(r+1);if(void 0!==n&&"error_table"===n&&""!==l)if(i!==s||""!==a&&0!=a)if(i===s&&""!==a){t.push(a);let e=findArrDuplicate(t),n=l.split("|")[0].trim();e.length>0&&e.includes(a)&&o.includes("unique")?($(this).closest(".form-group").addClass("has-error"),Toast.fire({type:"error",title:l})):n===a?(l=l.split("|")[1].trim(),$(this).closest(".form-group").addClass("has-error"),Toast.fire({type:"error",title:l})):$(this).closest(".form-group").removeClass("has-error")}else o.includes("unique")||""===a||$(this).closest(".form-group").removeClass("has-error");else $(this).closest(".form-group").addClass("has-error"),Toast.fire({type:"error",title:l+" : "+e});else void 0!==n&&"error_table"!==n&&$(this).closest(".form-group").removeClass("has-error")}})}}else e.find("small[id="+r+"]:not(.line)").html(""),e.find("input:text[name="+d+"]:not(.line), select[name="+d+"], textarea[name="+d+"], input:password[name="+d+"]").not(".line").closest(".form-group").removeClass("has-error")}}function clearErrorForm(e){const t=e.find("input, textarea, select"),a=e.find("small");for(let a=0;a<t.length;a++)""!==t[a].name&&e.find("input[name="+t[a].name+"], textarea[name="+t[a].name+"], select[name="+t[a].name+"]").closest(".form-group").removeClass("has-error");for(let t=0;t<a.length;t++)""!==a[t].id&&e.find("small[id="+a[t].id+"]").html("")}function findArrDuplicate(e){return e.filter(function(e,t,a){return a.indexOf(e)!=t})}function clearForm(e){const t=$(e.target),a=t.closest(".row"),n=a.find(".card-form"),i=a.find("ul.nav-tabs");let o=n.length?n.find("form"):a.find("form");if(i.length){const e=a.find("div.card-tab"),t=e.find(".tab-pane"),n=e.find(".tab-pane.active");o.find("table.tb_displaytab");o=n.find("form"),null===setSave&&(o=t.find("form"),$.each(o,function(){this.reset()}))}o[0].reset();const s=o.find("input, textarea, select, button"),l=o.find("small");let r=[];fieldReadOnly=[...new Set(fieldReadOnly)];for(let e=0;e<s.length;e++)if(""!==s[e].name){if(0==fieldReadOnly.length?o.find("input[name="+s[e].name+"], textarea[name="+s[e].name+"]").removeAttr("readonly").closest(".form-group").removeClass("has-error"):fieldReadOnly.length>0&&(fieldReadOnly.includes(s[e].name)?o.find("input[name="+s[e].name+"], textarea[name="+s[e].name+"]").closest(".form-group").removeClass("has-error"):o.find("input[name="+s[e].name+"], textarea[name="+s[e].name+"]").removeAttr("readonly").closest(".form-group").removeClass("has-error")),fieldReadOnly.includes(s[e].name)||"checkbox"!==s[e].type||o.find("input:checkbox[name="+s[e].name+"]").removeAttr("disabled"),fieldReadOnly=[...new Set(fieldReadOnly)],r.length>0&&s[e].name===r[0].field&&r[0].condition)0==fieldReadOnly.length?o.find("select[name="+s[e].name+"]").val(r[0].id).change().removeAttr("disabled").closest(".form-group").removeClass("has-error"):fieldReadOnly.length>0&&(fieldReadOnly.includes(s[e].name)?o.find("select[name="+s[e].name+"]").val(r[0].id).change().closest(".form-group").removeClass("has-error"):o.find("select[name="+s[e].name+"]").val(r[0].id).change().removeAttr("disabled").closest(".form-group").removeClass("has-error"));else if(0==fieldReadOnly.length)o.find("select[name="+s[e].name+"]").val(null).change().removeAttr("disabled").closest(".form-group").removeClass("has-error");else if(fieldReadOnly.length>0)if(fieldReadOnly.includes(s[e].name)){if(o.find("select[name="+s[e].name+"]").length){let t=o.find("select[name="+s[e].name+"]").val();""===t&&o.find("select[name="+s[e].name+"]").val(null).change().closest(".form-group").removeClass("has-error")}if(o.find(".datepicker[name="+s[e].name+"]").length){let t=o.find(".datepicker[name="+s[e].name+"]").val();""===t&&o.find(".datepicker[name="+s[e].name+"]").data("DateTimePicker").clear()}}else o.find("select[name="+s[e].name+"]").val(null).change().removeAttr("disabled").closest(".form-group").removeClass("has-error");if("file"==s[e].type&&$(".close-img").click(),o.find("textarea.summernote[name="+s[e].name+"]").length&&($("[name ="+s[e].name+"]").summernote("reset"),$("[name ="+s[e].name+"]").summernote("destroy")),_tableLine.context.length){_tableLine.clear().draw();const e=_tableLine.rows().to$().find("button");$(".add_row, .create_line").css("display","block"),e.css("display","block")}$(s[e]).attr("edit-disabled")&&o.find("input:checkbox[name="+s[e].name+"], select[name="+s[e].name+"], input:radio[name="+s[e].name+"]").removeAttr("disabled"),$(s[e]).attr("edit-readonly")&&o.find("input:text[name="+s[e].name+"]").removeAttr("readonly"),o.find("input:radio[name="+s[e].name+"], button[name="+s[e].name+"]").removeAttr("disabled")}for(let e=0;e<l.length;e++)""!==l[e].id&&o.find("small[id="+l[e].id+"]").html("");o.find(".datepicker-start").length&&o.find(".datepicker-start").data("DateTimePicker").clear(),o.find(".datetimepicker-start").length&&o.find(".datetimepicker-start").data("DateTimePicker").clear(),o.find(".datepicker-end").length&&o.find(".datepicker-end").data("DateTimePicker").clear(),o.find(".datetimepicker-end").length&&o.find(".datetimepicker-end").data("DateTimePicker").clear(),o.find(".datetimepicker").length&&o.find(".datetimepicker").data("DateTimePicker").clear(),option=[],arrMultiSelect=[]}function readonly(e,t){const a=e.find("input, textarea, select, button");fieldReadOnly=[...new Set(fieldReadOnly)];for(let n=0;n<a.length;n++)if(""!==a[n].name){let i=a[n].className.split(/\s+/);fieldReadOnly.includes(a[n].name)||e.find("input:text[name="+a[n].name+"], textarea[name="+a[n].name+"], input:password[name="+a[n].name+"]").not(".line").prop("readonly",t),"text"===a[n].type||i.includes("active")||fieldReadOnly.includes(a[n].name)||e.find("input:checkbox[name="+a[n].name+"], select[name="+a[n].name+"], input:radio[name="+a[n].name+"], button[name="+a[n].name+"]").not(".line").prop("disabled",t),"file"===a[n].type&&e.find("input[name="+a[n].name+"]").not(".line").prop("disabled",t),(e.find("textarea.summernote[name="+a[n].name+"]").length>0||e.find("textarea.summernote-product[name="+a[n].name+"]").length>0)&&(t?$("[name ="+a[n].name+"]").not(".line").summernote("disable"):$("[name ="+a[n].name+"]").not(".line").summernote("enable"))}e.find("button.close-img").length>0&&(e.find("button.close-img").not(".line").prop("disabled",t),t?e.find("button.close-img").not(".line").css("display","none"):e.find("button.close-img").not(".line").css("display","block"))}function previewImage(e,t,a){let n=e.closest("label");if(t=t||".img-result",a=null==a?"":a,e.files&&e.files[0]){let a=new FileReader;a.onload=function(e){loadingForm(n.id,"pulse"),$(".save_form").attr("disabled",!0),$(".x_form").attr("disabled",!0),$(".close_form").attr("disabled",!0),setTimeout(function(){$(t).attr("src",e.target.result).width("auto").height(150),$(".form-upload-foto").css("display","none"),$(".form-result").css("display","block"),hideLoadingForm(n.id),$(".save_form").removeAttr("disabled"),$(".x_form").removeAttr("disabled"),$(".close_form").removeAttr("disabled")},2500)},a.readAsDataURL(e.files[0])}else""!==a?(a=ORI_URL+"/"+a,$.ajax({url:a,type:"HEAD",error:function(){$(t).attr("src","").width("auto").height(150),$(".form-upload-foto").css("display","block"),$(".form-result").css("display","none")},success:function(){loadingForm(n.id,"pulse"),$(".save_form").attr("disabled",!0),$(".x_form").attr("disabled",!0),$(".close_form").attr("disabled",!0),setTimeout(function(){$(t).attr("src",a).width("auto").height(150),$(".form-upload-foto").css("display","none"),$(".form-result").css("display","block"),hideLoadingForm(n.id),$(".save_form").removeAttr("disabled"),$(".x_form").removeAttr("disabled"),$(".close_form").removeAttr("disabled")},500)}})):($(t).attr("src","").width("auto").height(150),$(".form-upload-foto").css("display","block"),$(".form-result").css("display","none"))}function isAccess(e,t){let a,n=CURRENT_URL+"/accessmenu/getAccess";return $.ajax({url:n,type:"POST",data:{last_url:t,action:e},async:!1,dataType:"JSON",success:function(e){a=e},error:function(e,t){showError(e,t)}}),a}function setSeqCode(e){let t=CURRENT_URL+"/getSeqCode";$.getJSON(t,function(t){e.find("input.code").val(t[0].message)}).fail(function(e,t){showError(e,t)})}function showError(e,t){let a="";a=0===e.status?"Not connect.\n Verify Network.":404==e.status?"Requested page not found. [404]":500==e.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+e.responseText,Toast.fire({type:"error",title:a})}function loadingForm(e,t){$("#"+e).waitMe({effect:t,text:"Harap tunggu...",bg:"rgba(255,255,255,0.7)",color:"#000",maxSize:"",waitTime:-1,textPos:"vertical",fontSize:"100%",source:"",onClose:function(){}})}function hideLoadingForm(e){$("#"+e).waitMe("hide")}function openModalForm(){return $(".modal_form").modal({backdrop:"static",keyboard:!1})}function Scrollmodal(){return modalDialog.addClass("modal-dialog-scrollable")}function formatRupiah(e){let t=e.toString(),a=t.split(","),n=a[0].length%3,i=a[0].substr(0,n),o=a[0].substr(n).match(/\d{3}/gi);return o&&(separator=n?".":"",i+=separator+o.join(".")),i||""}function replaceRupiah(e){return e.replace(/\./g,"")}function initSelectData(e,t=null,a=null){$.each(e,function(e,n){let i=$(n).attr("data-url"),o=$(n).attr("default-id"),s=$(n).attr("default-text"),l="";if(-1!=i.lastIndexOf("$")&&(l=i.substr(i.lastIndexOf("$")+1),i=i.substr(0,i.lastIndexOf("$")-1)),void 0!==i&&""!==i&&(i=null!==t&&null!==a?ADMIN_URL+i+"?"+t+"="+a:ADMIN_URL+i,$(this).select2({placeholder:"Select an option",width:"100%",theme:"bootstrap",allowClear:!0,ajax:{dataType:"JSON",url:function(){return i},delay:250,data:function(e){return{search:e.term,name:l}},processResults:function(e,t){return{results:e}},cache:!0}}),void 0!==o&&""!==o&&void 0!==s&&""!==s)){let e=$("<option selected='selected'></option>").val(o).text(s);$(this).append(e).change()}})}function getList(e,t,a){let n;return $.ajax({url:ADMIN_URL+e,type:"POST",data:{field:t,reference:a},async:!1,dataType:"JSON",success:function(e){n=e}}),n}function removeItems(e,t){const a=e.indexOf(t);if(a>-1)return e.splice(a,1)}function getLogic(e){let t=[];return $.ajax({url:ADMIN_URL+e,type:"POST",async:!1,dataType:"JSON",success:function(e){t.push(e)}}),t}function initSummerNote(e){$.each(e,function(){$(this).summernote({fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Times New Roman"],tabsize:2,height:200,toolbar:[["style",["style","bold","italic","underline","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["view",["fullscreen","codeview","help"]],["height",["height"]]],placeholder:"write here..."})})}function showNotification(){let e=ADMIN_URL+"wactivity/showNotif";$.ajax({url:e,type:"GET",dataType:"JSON",success:function(e){e>0?$(".notif-workflow").addClass("notification").text(e):$(".notif-workflow").removeClass("notification").text("")}})}function mergeArrayObjects(e,t,a,n,i){return e.map((e,o)=>{if(e.row===t[o].row||e.row===a[o].row||e.row===n[o].row||e.row===i[o].row)return Object.assign({},e,t[o],a[o],n[o],i[o])})}function removeDuplicates(e,t){return[...new Map(e.map(e=>[t(e),e])).values()]}function checkExistUserRole(e){let t,a=ADMIN_URL+"role/getUserRoleName";return $.ajax({url:a,type:"POST",data:{role_name:e},async:!1,cache:!1,dataType:"JSON",success:function(e){t=e},error:function(e,t){showError(e,t)}}),t}function showFormData(e){const t=e.closest(".card-main"),a=t.find("div");let n=CURRENT_URL+SHOWALL;$.ajax({url:n,type:"GET",cache:!1,dataType:"JSON",beforeSend:function(){$(".reset_form").prop("disabled",!0),$(".save_form").prop("disabled",!0)},complete:function(){$(".reset_form").removeAttr("disabled"),$(".save_form").removeAttr("disabled"),$(".main-panel").removeClass("is-loading")},success:function(t){if(t[0].success){let n=t[0].message;if(n.header){let t=n.header,i=t.length;if(i>1){putFieldData(e,t);for(let e=0;e<t.length;e++){let a=t[e].label,n=t[e].primarykey;n&&(setSave="update",ID=a)}$.each(a,function(){$(this).attr("show-after-save")&&$(this).removeClass("d-none")})}else{const t=e.find("input, textarea, select");for(let a=0;a<t.length;a++){let n=[];if(""!==t[a].name){if($(t[a]).attr("hide-field"))if(n=$(t[a]).attr("hide-field").split(",").map(e=>e.trim()),"checkbox"===t[a].type)if(t[a].checked)for(let t=0;t<n.length;t++){let a=e.find("input[name="+n[t]+"], textarea[name="+n[t]+"], select[name="+n[t]+"]").closest(".form-group, .form-check");a.hide()}else for(let t=0;t<n.length;t++){let a=e.find("input[name="+n[t]+"], textarea[name="+n[t]+"], select[name="+n[t]+"]").closest(".form-group, .form-check");a.show()}else for(let t=0;t<n.length;t++){let a=e.find("input[name="+n[t]+"], textarea[name="+n[t]+"], select[name="+n[t]+"]").closest(".form-group, .form-check");a.hide()}if($(t[a]).attr("show-field"))if(n=$(t[a]).attr("show-field").split(",").map(e=>e.trim()),"checkbox"===t[a].type){if(t[a].checked)for(let t=0;t<n.length;t++){let a=e.find("input[name="+n[t]+"], textarea[name="+n[t]+"], select[name="+n[t]+"]").closest(".form-group, .form-check");a.show()}else if("checkbox"===t[a].type)for(let t=0;t<n.length;t++){let a=e.find("input[name="+n[t]+"], textarea[name="+n[t]+"], select[name="+n[t]+"]").closest(".form-group, .form-check");a.hide()}}else for(let t=0;t<n.length;t++){let a=e.find("input[name="+n[t]+"], textarea[name="+n[t]+"], select[name="+n[t]+"]").closest(".form-group, .form-check");a.show()}}}}}if(n.barcode){let e=n.barcode;$.each(a,function(){let t=this.className.split(/\s+/);if(t.includes("card-barcode")){const t=$(this).find(".barcode");var a="";"JPG"===e.barcodetype||"PNG"===e.barcodetype?a+='<img src="data:image/png;base64,'+e.barcode+'"/>':a+=e.barcode,""!==e.position&&0!=e.size&&(a+='<p class="'+e.position+'" style="font-size: '+e.size+'px">'+e.text+"</p>"),t.html(a)}})}}}})}function putFieldData(e,t){const a=e.closest(".modal-tab");if(t.length>1){const n=e.find("input, textarea, select").not(".line");if(e.find("select.select-data").length>0){let a=e.find("select.select-data");initSelectData(a,t[1].field,t[1].label)}if(a.length){const e=a.find("form");$.each(e,function(){const e=$(this).find("input, textarea, select").not(".line");for(let t=0;t<e.length;t++)!e[t].readOnly&&!e[t].disabled||"radio"===e[t].type||changeTab||fieldReadOnly.push(e[t].name),e[t].checked&&!changeTab&&fieldChecked.push(e[t].name)})}else for(let e=0;e<n.length;e++)(n[e].readOnly||n[e].disabled)&&"radio"!==n[e].type&&fieldReadOnly.push(n[e].name),n[e].checked&&fieldChecked.push(n[e].name);"detail"===setSave&&readonly(e,!0);for(let a=0;a<t.length;a++){let i=t[a].field,o=t[a].label;for(let t=0;t<n.length;t++){let a=[],s=n[t].name;if(""!==s&&s===i){let a=n[t].className.split(/\s+/);if(a.includes("datepicker")?null!==o&&e.find("input:text[name="+s+"]").not(".line").val(moment(o).format("DD-MMM-Y")):a.includes("rupiah")?e.find("input:text[name="+s+"]").not(".line").val(formatRupiah(o)):void 0===$(n[t]).attr("set-id")&&"file"!==n[t].type&&e.find("input:text[name="+s+"], input:hidden[name="+s+"], textarea[name="+s+"], input:password[name="+s+"] ").not(".line").val(o),(e.find("textarea.summernote[name="+s+"]").length>0||e.find("textarea.summernote-product[name="+s+"]").length>0)&&$("[name ="+s+"]").not(".line").summernote("code",o),"select-one"===n[t].type)if("object"==typeof o&&null!==o){let t=o.id,a=o.name;option.push({fieldName:s,option_ID:t,option_Txt:a});let n=$("<option selected='selected'></option>").val(t).text(a);e.find("select[name="+s+"]").not(".line").append(n).change()}else"string"!=typeof o||null===o&&0==o||(option.push({fieldName:s,label:o}),e.find("select[name="+s+"]").not(".line").val(o).change());if("select-multiple"===n[t].type&&null!==o&&("object"==typeof o&&(o=o.id,arrMultiSelect.push(o),e.find("select[name="+s+"]").not(".line").val(arrMultiSelect).change()),"string"==typeof o)){let t=o.split(",");t.length>1?e.find("select[name="+s+"]").not(".line").val(t).change():(arrMultiSelect.push(o),e.find("select[name="+s+"]").not(".line").val(arrMultiSelect).change())}$(n[t]).attr("edit-disabled")&&e.find("input:checkbox[name="+s+"], select[name="+s+"], input:radio[name="+s+"]").not(".line").prop("disabled",!0),$(n[t]).attr("edit-readonly")&&e.find("input:text[name="+s+"]").not(".line").prop("readonly",!0),"checkbox"===n[t].type&&("Y"===o?e.find("input[name="+s+"]").not(".line").prop("checked",!0):"N"===o&&e.find("input[name="+s+"]").not(".line").removeAttr("checked"),a.includes("active")&&n[t].checked?readonly(e,!1):a.includes("active")&&!n[t].checked&&readonly(e,!0)),"radio"==n[t].type&&n[t].value==o&&(n[t].checked=!0),"file"===n[t].type&&a.includes("control-upload-image")&&previewImage(e.find("input[name="+s+"]")[0],"",o)}if($(n[t]).attr("hide-field")&&""!==s){if(a=$(n[t]).attr("hide-field").split(",").map(e=>e.trim()),"checkbox"===n[t].type)if(n[t].checked)for(let t=0;t<a.length;t++){let n=e.find("input[name="+a[t]+"], textarea[name="+a[t]+"], select[name="+a[t]+"]").not(".line").closest(".form-group, .form-check");n.hide()}else for(let t=0;t<a.length;t++){let n=e.find("input[name="+a[t]+"], textarea[name="+a[t]+"], select[name="+a[t]+"]").not(".line").closest(".form-group, .form-check");n.show()}if("select-one"===n[t].type)for(let t=0;t<a.length;t++){const n=e.find("select[name="+a[t]+"]").not(".line");let i=[];null===$(n).val()&&""===$(n).val()?(i=$(n).closest(".form-group"),i.hide()):null!==$(n).val()&&""!==$(n).val()?(i=$(n).closest(".form-group"),i.show()):null===$(n).val()&&(i=$(n).closest(".form-group"),i.hide())}if("radio"===n[t].type&&n[t].checked)for(let t=0;t<a.length;t++){const n=e.find("input[name="+a[t]+"], textarea[name="+a[t]+"], select[name="+a[t]+"]").not(".line");null!==n.val()?n.closest(".form-group").show():n.closest(".form-group").hide()}}if($(n[t]).attr("show-field")&&""!==s&&(a=$(n[t]).attr("show-field").split(",").map(e=>e.trim()),"checkbox"===n[t].type))if(n[t].checked)for(let t=0;t<a.length;t++){let n=e.find("input[name="+a[t]+"], textarea[name="+a[t]+"], select[name="+a[t]+"]").not(".line").closest(".form-group, .form-check");n.show()}else if("checkbox"===n[t].type)for(let t=0;t<a.length;t++){let n=e.find("input[name="+a[t]+"], textarea[name="+a[t]+"], select[name="+a[t]+"]").not(".line").closest(".form-group, .form-check");n.hide()}}}}}function prosesTestEmail(e){const t=$(e).closest("form");let a=CURRENT_URL+TEST_EMAIL,n=new FormData(t[0]);Swal.fire({title:"Test EMail",text:"Test EMail Connection on info defined.",type:"info",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonText:"Ok",cancelButtonText:"Close",showLoaderOnConfirm:!0,reverseButtons:!0,onOpen:()=>{},preConfirm:e=>new Promise(function(e){$.ajax({type:"POST",url:a,data:n,processData:!1,contentType:!1,cache:!1,dataType:"JSON",success:function(a){a[0].success?(Swal.fire({title:"Test EMail",text:a[0].message,type:"success",showConfirmButton:!0}),clearErrorForm(t)):a[0].error&&a.length>1?(errorForm(t,a),e(!0)):(Swal.showValidationMessage(a[0].message),e(!1))},error:function(t,a,n){Swal.showValidationMessage(n),e(!1)}})}),allowOutsideClick:()=>!Swal.isLoading()})}function downloadFile(e){let t=e.substr(e.lastIndexOf("/")+1);$.ajax({url:e,method:"GET",xhrFields:{responseType:"blob"},success:function(e){var a=document.createElement("a"),n=window.URL.createObjectURL(e);a.href=n,a.download=t,document.body.append(a),a.click(),a.remove(),window.URL.revokeObjectURL(n)}})}function showForeignKey(e,t,a){e=`${ADMIN_URL}${e}/${t}`,$.getJSON(e,function(e){a.val(e.text)}).fail(function(e,t,a){console.info(a)})}const ADMIN="/sas/";let _table,_tableLine,ul,formTable,_tableInfo,formReport,_tableReport,_tableApproval,ORI_URL=window.location.origin,CURRENT_URL=window.location.href,LAST_URL=CURRENT_URL.substr(CURRENT_URL.lastIndexOf("/")+1),ADMIN_URL=ORI_URL+ADMIN,SITE_URL=ADMIN_URL+LAST_URL,ID=0,setSave=null,clear=!1,changeTab=!1,option=[],fieldReadOnly=[],fieldChecked=[],arrMultiSelect=[];const SHOWALL="/showAll",CREATE="/create",SHOW="/show/",EDIT="/edit",DELETE="/destroy/",EXPORT="/export",IMPORT="/import",TABLE_LINE="/tableLine",DELETE_LINE="/destroyLine/",TEST_EMAIL="/createTestEmail",ACCEPT="/accept/",PRINT="/print/";let cardMain=$(".card-main"),cardForm=$(".card-form"),cardBtn=$(".card-button"),cardTitle=$(".card-title");const modalForm=$(".modal_form"),modalDialog=$(".modal-dialog"),modalTitle=$(".modal-title"),modalBody=$(".modal-body");$(document).ready(function(e){const t=$(".container"),a=t.find(".card"),n=t.find(".card-action-menu"),i=n.attr("data-action-menu");if(void 0===i&&"F"!==i)$(".main-panel").removeClass("is-loading");else{const e=a.find("form");showFormData(e)}showNotification(),Pusher.logToConsole=!1;var o=new Pusher("8ae4540d78a7d493226a",{cluster:"ap1"}),s=o.subscribe("my-channel");s.bind("my-event",function(e){showNotification()}),$(".select2").select2({placeholder:"Select an option",width:"100%",theme:"bootstrap",allowClear:!0}),$(".multiple-select").select2({width:"100%",theme:"bootstrap",multiple:!0}),$(".number").on("keypress keyup blur",function(e){$(this).val($(this).val().replace(/[^\d-].+/,"")),(e.which<48&&45!=e.which||e.which>57&&189!=e.which)&&e.preventDefault()}),$(this).find(".rupiah").autoNumeric("init",{aSep:".",aDec:",",mDec:"0"}),Toast=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:4e3}),$(".datepicker").datetimepicker({format:"DD-MMM-YYYY",showTodayButton:!0,showClear:!0,showClose:!0,useCurrent:!1}),$(".datetimepicker").datetimepicker({format:"DD-MMM-YYYY HH:mm:ss",showTodayButton:!0,showClear:!0,showClose:!0,useCurrent:!1}),$(".datepicker-start").datetimepicker({format:"DD-MMM-YYYY",showTodayButton:!0,showClear:!0,showClose:!0,daysOfWeekDisabled:[0,6],useCurrent:!1}),$(".datetimepicker-start").datetimepicker({format:"DD-MMM-YYYY HH:mm:ss",showTodayButton:!0,showClear:!0,showClose:!0,daysOfWeekDisabled:[0,6],useCurrent:!1}),$(".datepicker-end").datetimepicker({format:"DD-MMM-YYYY",showTodayButton:!0,showClear:!0,showClose:!0,daysOfWeekDisabled:[0,6],useCurrent:!1}),$(".datetimepicker-end").datetimepicker({format:"DD-MMM-YYYY HH:mm:ss",showTodayButton:!0,showClear:!0,showClose:!0,daysOfWeekDisabled:[0,6],useCurrent:!1}),$(".datepicker-start").on("dp.change",function(e){$(".datepicker-end").data("DateTimePicker").minDate(e.date)}),$(".datetimepicker-start").on("dp.change",function(e){$(".datetimepicker-end").data("DateTimePicker").minDate(e.date)}),$(".datepicker-end").on("dp.change",function(e){""!==$(".datepicker-start").val()?$(".datepicker-start").data("DateTimePicker").maxDate(e.date):$(".datepicker-start").data("DateTimePicker").useCurrent(!0).maxDate(e.date)}),$(".datetimepicker-end").on("dp.change",function(e){""!==$(".datetimepicker-start").val()?$(".datetimepicker-start").data("DateTimePicker").maxDate(e.date):$(".datetimepicker-start").data("DateTimePicker").useCurrent(!0).maxDate(e.date)}),$(".monthyear").datetimepicker({format:"MMM-YYYY",showClear:!0,useCurrent:!1}),$(".daterange").daterangepicker({autoUpdateInput:!1,locale:{format:"YYYY-MM-DD",cancelLabel:"Clear"}}),$(".daterange").on("apply.daterangepicker",function(e,t){$(this).val(t.startDate.format("YYYY-MM-DD")+" - "+t.endDate.format("YYYY-MM-DD"))}),
$(".daterange").on("cancel.daterangepicker",function(e,t){$(this).val("")}),$(".summernote-product").summernote({fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Times New Roman"],tabsize:2,height:200,toolbar:[["style",["style","bold","italic","underline","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["height",["height"]]],placeholder:"write here..."}),$(".float-number").autoNumeric("init",{aSep:",",mDec:"0"}),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){$(this).remove()})},4e3),$(".tb_display").length>0&&(new $.fn.dataTable.Buttons(_table,{buttons:[{extend:"collection",className:"btn btn-warning btn-sm btn-round ml-auto text-white mr-1",text:'<i class="fas fa-download fa-fw"></i> Export',autoClose:!0,buttons:[{extend:"pdfHtml5",text:'<i class="fas fa-file-pdf"></i> PDF',titleAttr:"Export to PDF",title:"",pageSize:"A4",exportOptions:{columns:":visible:not(:last-child)"}},{extend:"csvHtml5",text:'<i class="fas fa-file"></i> CSV',titleAttr:"Export to CSV",title:"",exportOptions:{columns:":visible:not(:last-child)"}},{extend:"excelHtml5",text:'<i class="fas fa-file-excel"></i> Excel',titleAttr:"Export to Excel",title:"",customize:function(e){var t=e.xl.worksheets["sheet1.xml"];$("row:first c",t).attr("s","27"),$("row:not(:first) c",t).attr("s","25")},exportOptions:{columns:":visible:not(:last-child)"}}]}]}),_table.buttons().container().appendTo($("#dt-button")))}),_table=$(".tb_display").DataTable({serverSide:!0,ajax:{url:CURRENT_URL+SHOWALL,type:"POST",data:function(e,t){const a=$(t.nTable).closest(".container"),n=a.find(".filter_page"),i=n.find("form"),o=i.find("[disabled]");return o.removeAttr("disabled"),formTable=i.serializeArray(),o.prop("disabled",!0),$.extend({},e,{form:formTable})}},columnDefs:[{targets:[1,-1],orderable:!1,width:2},{targets:0,visible:!1}],lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],order:[],autoWidth:!1,scrollX:!0,scrollY:"50vh",scrollCollapse:!0,fixedColumns:checkFixedColumns()}).columns.adjust(),_tableLine=$(".tb_displayline").DataTable({drawCallback:function(e){$(this).find(".number").on("keypress keyup blur",function(e){$(this).val($(this).val().replace(/[^\d-].+/,"")),(e.which<48&&45!=e.which||e.which>57&&189!=e.which)&&e.preventDefault()}),$(this).find(".select2").select2({placeholder:"Select an option",theme:"bootstrap",allowClear:!0}),$(this).find(".rupiah").autoNumeric("init",{aSep:".",aDec:",",mDec:"0"})},initComplete:function(e,t){$(".tb_displayline").wrap("<div style='overflow:auto; width:100%; position:relative;'></div>")},lengthChange:!1,paging:!1,searching:!1,ordering:!1,autoWidth:!1}),$(".tb_tree").treeFy({initState:"expanded",treeColumn:0,collapseAnimateCallback:function(e){e.fadeOut()},expandAnimateCallback:function(e){e.fadeIn()}}),_tableInfo=$(".table_info").DataTable({processing:!0,drawCallback:function(e){$(this).find(".number").on("keypress keyup blur",function(e){$(this).val($(this).val().replace(/[^\d-].+/,"")),(e.which<48&&45!=e.which||e.which>57&&189!=e.which)&&e.preventDefault()}),$(this).find(".select2").select2({placeholder:"Select an option",theme:"bootstrap",allowClear:!0}),$(this).find(".rupiah").autoNumeric("init",{aSep:".",aDec:",",mDec:"0"})},columnDefs:[{targets:[0,1],orderable:!1,width:2},{targets:0,visible:!1}],displayLength:-1,lengthChange:!1,info:!1,searching:!1,paging:!1,autoWidth:!1,scrollX:!0,scrollY:"350px",scrollCollapse:!0}),_tableReport=$(".table_report").DataTable({serverSide:!0,processing:!0,language:{processing:'<i class="fa fa-spinner fa-spin fa-10x fa-fw"></i><span> Processing...</span>'},ajax:{url:CURRENT_URL+SHOWALL,type:"POST",data:function(e,t){return $.extend({},e,{form:formReport,clear:clear})}},columnDefs:[{targets:"_all",orderable:!1},{targets:0,width:2},{targets:1,width:"10%"}],order:[],displayLength:-1,lengthChange:!1,language:{info:"Total Data <span class='badge badge-primary'>_TOTAL_</span>",infoFiltered:""},searching:!1,paging:!1,autoWidth:!1,scrollX:!0,scrollY:"70vh",scrollCollapse:!0}).columns.adjust(),_tableApproval=$(".table_approval").DataTable({processing:!0,columnDefs:[{targets:"_all",orderable:!1},{targets:[0,1,2,3],visible:!1},{targets:[4],width:"20%"}],order:[],displayLength:-1,lengthChange:!1,info:!1,searching:!1,paging:!1,autoWidth:!1}).columns.adjust(),$(".save_form").click(function(e){const t=$(this),a=$(e.target),n=a.closest(".container"),i=a.closest(".row"),o=n.find(".card"),s=o.attr("data-action-menu"),l=(cardForm.find("div"),i.find("ul.nav-tabs"));let r=t.html(),d=n.find(".page-title").text();cardForm=i.find(".card-form").length?i.find(".card-form"):i.find(".card-main");let c=cardForm.find("form"),f=null,m=CURRENT_URL+CREATE;if(l.length){const e=i.find("div.card-tab");let t=l.find("li a.active"),a=t.attr("href");f=e.find(".tab-pane.active"),t.prop("classList").contains("dropdown-toggle")&&(t=t.closest("li").find("div a.active"),a=t.attr("href")),c=f.find("form"),a=a.substring(1,a.length),m=`${ADMIN_URL}${a}${CREATE}`}let p="create",u=isAccess(p,LAST_URL),h=new FormData;if(u[0].success&&"Y"==u[0].message){let a;$.each(c,function(){const e=$(this).find(".row");a=$(e).find("input, select, textarea").not(".line")});for(let e=0;e<a.length;e++)if(""!==a[e].name){let t=a[e].className.split(/\s+/);if(c.find("input:checkbox[name="+a[e].name+"], select[name="+a[e].name+"]").not(".line").removeAttr("disabled"),"text"!=a[e].type&&"textarea"!=a[e].type&&"select-one"!=a[e].type&&"password"!=a[e].type&&"hidden"!=a[e].type||h.append(a[e].name,a[e].value),"radio"==a[e].type&&a[e].checked&&h.append(a[e].name,a[e].value),"file"==a[e].type&&t.includes("control-upload-image"))if(a[e].files.length>0)h.append(a[e].name,a[e].files[0]);else{let t=c.find(".img-result").attr("src"),n=t;void 0!==t&&""!==t&&(n=t.substr(t.lastIndexOf("/")+1)),h.append(a[e].name,n)}if(c.find("textarea.summernote[name="+a[e].name+"]").length&&$("[name ="+a[e].name+"]").summernote("isEmpty")&&h.append(a[e].name,""),"select-multiple"===a[e].type&&h.append(a[e].name,$("[name = "+a[e].name+"]").val()),"checkbox"==a[e].type){let t=a[e].checked?"Y":"N";h.append(a[e].name,t)}if(t.includes("datepicker")||t.includes("datepicker-start")||t.includes("datepicker-end")||t.includes("datetimepicker-start")||t.includes("datetimepicker-end")||t.includes("datetimepicker")){let t=a[e].value;if(""!==t){let n=moment(t).format("YYYY-MM-DD HH:mm:ss");h.append(a[e].name,n)}}t.includes("rupiah")&&h.append(a[e].name,replaceRupiah(a[e].value)),t.includes("foreignkey")&&h.append(a[e].name,$(a[e]).attr("set-id"))}if(c.find("table.tb_tree").length>0){const e=c.find("table.tb_tree"),t=e.find("td input:checkbox");let a=[],n=[],i=[],o=[],s=[];$.each(t,function(){let e,t=$(this).parent().parent().parent().parent().index(),l=$(this).attr("name"),r=$(this).val(),d=$(this).attr("data-menu"),c=void 0!==$(this).attr("id")?$(this).attr("id"):0;e=$(this).is(":checked")?"Y":"N","isview"==l?a.push({row:t,view:e,menu_id:r,menu:d}):"iscreate"==l?n.push({row:t,create:e,menu_id:r,menu:d}):"isupdate"==l?i.push({row:t,update:e,menu_id:r,menu:d}):"isdelete"==l&&o.push({row:t,delete:e,menu_id:r,menu:d}),"add"!==setSave&&s.push({row:t,access_id:c})}),s=removeDuplicates(s,e=>e.row);let l=mergeArrayObjects(a,n,i,o,s);h.append("roles",JSON.stringify(l))}if(_tableLine.context.length){const e=_tableLine.rows().nodes().to$(),t=$(e).closest("table").find("th");let a=[],n=[];$.each(t,function(e,t){$(t).attr("field")&&n.push({position:e,name:$(t).attr("field")})}),$.each(e,function(e){const t=$(this).find("input, select, button, span"),i=$(this).closest("tr"),o=i.find("td");let s={};$.each(t,function(){let e=this.className.split(/\s+/),t=$(this).attr("name"),a=this.value,n=$(this).attr("id");const i=c.find("input.foreignkey");if(e.includes("rupiah")&&(a=replaceRupiah(a)),"text"===this.type||"select-one"===this.type)if(e.includes("datepicker")){let e=a;if(""!==e){let a=moment(e).format("YYYY-MM-DD HH:mm:ss");s[t]=a}}else s[t]=a;else"checkbox"===this.type?s[t]=$(this).is(":checked")?"Y":"N":void 0!==t?(s[t]=""!==n?n:"",e.includes("reference-key")&&(s[t]=a)):s[i.attr("name")]=i.attr("set-id")}),$.each(o,function(e,t){let a=$(t).text();$.each(n,function(t,n){e==n.position&&(s[n.name]=a)})}),a[e]=s}),h.append("table",JSON.stringify(a))}(null==f&&"add"!==setSave||null!=f&&void 0!==f.attr("set-save")&&"update"===f.attr("set-save"))&&h.append("id",ID),$.ajax({url:m,type:"POST",data:h,processData:!1,contentType:!1,cache:!1,dataType:"JSON",beforeSend:function(){$(t).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>').prop("disabled",!0),$(".x_form").prop("disabled",!0),$(".close_form").prop("disabled",!0),loadingForm(c.prop("id"),"facebook")},complete:function(){$(t).html(r).prop("disabled",!1),$(".x_form").removeAttr("disabled"),$(".close_form").removeAttr("disabled"),hideLoadingForm(c.prop("id"))},success:function(t){if(t[0].success)if(Toast.fire({type:"success",title:t[0].message}),"F"===s)showFormData(c),clearErrorForm(c);else if(n.find(".modal").length){let a=i.find(".modal"),n=a.attr("id");if(i.find(".modal-tab").length){const e=i.find(".tab-pane"),a=l.find("li.nav-item a");if(f.attr("set-save","update"),void 0!==t[0].foreignkey&&(ID=t[0].foreignkey,f.attr("set-id",ID),$.each(a,function(){this.classList.contains("active")||$(this).removeClass("disabled")}),$.each(e,function(){const e=$(this).find("form");e.find("input.foreignkey").attr("set-id",ID)})),void 0!==t[0].primarykey&&(ID=t[0].primarykey),void 0!==t[0].header&&putFieldData(c,t[0].header),t[0].line){let e=t[0].line;if(_tableLine.context.length){_tableLine.clear().draw();let t=JSON.parse(e);_tableLine.rows.add(t).draw(!1)}}}else $(`#${n}`).modal("hide"),clearForm(e)}else{clearForm(e);const t=n.find(".card-body");$.each(t,function(e,t){let a=t.className.split(/\s+/);if(a.includes("card-main")){$(this).css("display","block");let e=ul.find("li");$.each(e,function(e,t){e>2&&t.remove()}),i.find("div.filter_page").length>0&&i.find("div.filter_page").css("display","block")}if(a.includes("card-form")){const e=i.find(".card-header");e.find("button").show(),$(this).css("display","none")}}),cardBtn.css("display","none");const a=i.find(".card-header"),o=a.find("button").prop("classList");o.contains("new_form")&&a.find("button").css("display","block"),cardTitle.html(d),$(".btn_requery").click()}else t[0].error?(errorForm(c,t),$("html, body").animate({scrollTop:$(".container").offset().top},1500)):(Toast.fire({type:"error",title:t[0].message}),clearErrorForm(c))},error:function(e,t){showError(e,t)}});for(let e=0;e<a.length;e++){let t=c.find("input.active");if(""!==a[e].name&&t.length){let t=a[e].className.split(/\s+/);c.find("input.active").is(":checked")?fieldReadOnly.includes(a[e].name)?c.find("input:checkbox[name="+a[e].name+"], select[name="+a[e].name+"]").not(".line").prop("disabled",!0):c.find("input:checkbox[name="+a[e].name+"], select[name="+a[e].name+"]").removeAttr("disabled"):t.includes("active")||c.find("input:checkbox[name="+a[e].name+"], select[name="+a[e].name+"]").not(".line").prop("disabled",!0)}else(fieldReadOnly.includes(a[e].name)||"add"!==setSave&&$(a[e]).attr("edit-disabled")||"detail"===setSave)&&c.find("input:checkbox[name="+a[e].name+"], select[name="+a[e].name+"]").not(".line").prop("disabled",!0)}}else u[0].success&&"N"==u[0].message?Toast.fire({type:"error",title:"You are role don't have permission, please reload !!"}):Toast.fire({type:"error",title:u[0].message})}),$(".tb_displayline, .tb_displaytab").on("click",".btn_delete",function(e){e.preventDefault();const t=$(this),a=t.closest("tr"),n=_tableLine.row(a);let i=this.id,o=t.html();$(t).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>').prop("disabled",!0),""===i?setTimeout(function(){n.remove().draw(!1),$(t).html(o).prop("disabled",!1)},100):(Swal.fire({title:"Delete?",text:"Are you sure to delete the selected data line ? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Ok",cancelButtonText:"Close",reverseButtons:!0}).then(e=>{e.value&&n.remove().draw(!1)}),$(t).html(o).prop("disabled",!1))}),$(document).on("click",".x_form, .close_form, .reset_form",function(e){const t=$(e.currentTarget),a=t.closest(".container"),n=a.find(".card"),i=n.attr("data-action-menu"),o=n.find("div"),s=t.closest(".modal-tab");let l=a.find(".page-title").text();if(setSave=null,"F"!==i){if("modal"!==t.attr("data-dismiss")){const e=t.closest(".container"),a=e.find(".card-body");$.each(a,function(t,a){let n=a.className.split(/\s+/);if(n.includes("card-main")){$(this).css("display","block");let t=ul.find("li");$.each(t,function(e,t){e>2&&t.remove()}),e.find("div.filter_page").length>0&&e.find("div.filter_page").css("display","block")}n.includes("card-form")&&$(this).css("display","none")}),cardBtn.css("display","none");const n=e.find(".card-header");n.find("button").show()}cardTitle.html(l),$(".btn_requery").click(),$("html, body").animate({scrollTop:$(".main-panel").offset().top},500)}if(s.length){const e=s.find(".tab-pane"),t=s.find("li.nav-item a");$.each(t,function(e){0==e?$(this).addClass("show active"):$(this).removeClass("active")}),$.each(e,function(e){const t=$(this).find("form");t.find("input.foreignkey").removeAttr("set-id"),$(this).removeAttr("set-save"),$(this).removeAttr("set-id"),0==e?$(this).addClass("show active"):$(this).removeClass("show active")})}ID=0,clearForm(e),$.each(o,function(){$(this).attr("show-after-save")&&$(this).addClass("d-none")}),$(this).removeAttr("disabled"),$(".save_form").removeAttr("disabled")}),$(document).on("click",".new_form",function(e){const t=$(e.target),a=t.closest(".container"),n=a.find(".card-body"),i=a.find(".main_page"),o=a.find(".modal-tab");let s,l=a.find(".card"),r="create",d=a.find(".page-title").text(),c=$(this),f=c.html(),m=c.text().trim(),p=isAccess(r,LAST_URL);$(this).tooltip("hide"),p[0].success&&"Y"==p[0].message?($(c).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'+m).prop("disabled",!0),l=l.length>1?a.find(".page-inner"):i.find(".card"),l.length&&(l.addClass("is-loading"),setTimeout(function(){if($.each(n,function(e,i){let o=i.className.split(/\s+/);if(n.length>1){if(o.includes("card-main")){$(this).css("display","none"),ul=a.find(".page-header > ul.breadcrumbs"),ul.find("li.nav-item > a").attr("href",CURRENT_URL);let e='<li class="separator"><i class="flaticon-right-arrow"></i></li>';e+='<li class="nav-item"><a class="text-primary font-weight-bold">Create</a></li>',ul.append(e),a.find("div.filter_page").length&&a.find("div.filter_page").css("display","none")}if(o.includes("card-form")){const e=t.closest(".card-header");e.find("button").css("display","none"),$(this).css("display","block"),cardBtn.css("display","block"),cardTitle.html("New "+d),s=$(this).find("form")}}}),o.length){let e=o.attr("id");$(`#${e}`).modal({backdrop:"static",keyboard:!1});const t=o.find("li.nav-item a");$.each(t,function(){this.classList.contains("active")||$(this).addClass("disabled")}),Scrollmodal(),s=o.find("form")}const e=s.find("input, textarea, select");for(let t=0;t<e.length;t++){let a=[];if(""!==e[t].name){if((e[t].readOnly||e[t].disabled)&&fieldReadOnly.push(e[t].name),"checkbox"==e[t].type&&fieldChecked.includes(e[t].name)&&s.find("input:checkbox[name="+e[t].name+"]").prop("checked",!0),$(e[t]).attr("hide-field"))if(a=$(e[t]).attr("hide-field").split(",").map(e=>e.trim()),"checkbox"===e[t].type)if(e[t].checked)for(let e=0;e<a.length;e++){let t=s.find("input[name="+a[e]+"], textarea[name="+a[e]+"], select[name="+a[e]+"]").closest(".form-group, .form-check");t.hide()}else for(let e=0;e<a.length;e++){let t=s.find("input[name="+a[e]+"], textarea[name="+a[e]+"], select[name="+a[e]+"]").closest(".form-group, .form-check");t.show()}else for(let e=0;e<a.length;e++){let t=s.find("input[name="+a[e]+"], textarea[name="+a[e]+"], select[name="+a[e]+"]").closest(".form-group, .form-check");t.hide()}if($(e[t]).attr("show-field"))if(a=$(e[t]).attr("show-field").split(",").map(e=>e.trim()),"checkbox"===e[t].type){if(e[t].checked)for(let e=0;e<a.length;e++){let t=s.find("input[name="+a[e]+"], textarea[name="+a[e]+"], select[name="+a[e]+"]").closest(".form-group, .form-check");t.show()}else if("checkbox"===e[t].type)for(let e=0;e<a.length;e++){let t=s.find("input[name="+a[e]+"], textarea[name="+a[e]+"], select[name="+a[e]+"]").closest(".form-group, .form-check");t.hide()}}else for(let e=0;e<a.length;e++){let t=s.find("input[name="+a[e]+"], textarea[name="+a[e]+"], select[name="+a[e]+"]").closest(".form-group, .form-check");t.show()}}}s.find("input:file.control-upload-image").length&&s.find(".img-result").attr("src",""),s.find("input.code").length&&setSeqCode(s),s.find("select.select-data").length&&initSelectData(s.find("select.select-data")),s.find(".summernote").length&&initSummerNote(s.find(".summernote")),s.find('input[type="checkbox"].active').length&&s.find('input[type="checkbox"].active').prop("checked",!0),s.find("button.delete_line").length&&s.find("button.delete_line").hide(),$(".check-all").parent().hide(),setSave="add",$(c).html(f).prop("disabled",!1),l.removeClass("is-loading")},200))):p[0].success&&"N"==p[0].message?Toast.fire({type:"warning",title:"You are role don't have permission, please reload !!"}):Toast.fire({type:"error",title:p[0].message})}),$(".btn_export").click(function(e){const t=$(e.target).closest(".container"),a=t.find(".card-filter");let n=a.find("form"),i=$(this),o=i.html();n.attr("action",SITE_URL+EXPORT),n.attr("method","POST"),n.submit(),$(i).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>').prop("disabled",!0),setTimeout(function(){$(i).html(o).prop("disabled",!1)},700)}),$(".btn_filter").click(function(e){let t=$(this);const a=t.parents(".container"),n=a.find(".main_page"),i=a.find("form");let o=t.html(),s=t.text().trim(),l=a.find(".card");l=l.length>1?a.find(".page-inner"):n.find(".card"),formTable=i.serializeArray(),$(t).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'+s).prop("disabled",!0),l.length&&(l.addClass("is-loading"),reloadTable(),setTimeout(function(){l.removeClass("is-loading"),$(t).html(o).prop("disabled",!1)},700))}),$(".btn_requery").click(function(){let e=$(this);const t=e.parents(".container"),a=t.find(".main_page");let n=t.find(".card");n=n.length>1?t.find(".page-inner"):a.find(".card"),clear=!1,n.length&&(n.addClass("is-loading"),reloadTable(),setTimeout(function(){n.removeClass("is-loading")},500))}),$(".add_row").click(function(e){const t=$(e.target),a=t.closest(".modal"),n=a.find("ul.nav-tabs"),i=t.closest("form");let o="create",s=isAccess(o,LAST_URL);if(s[0].success&&"Y"==s[0].message){let e=$(this),t=e.html(),o=e.text().trim(),s=CURRENT_URL+TABLE_LINE;if(n.length){const e=a.find("div.card-tab");let t=n.find("li a.active"),i=t.attr("href");tabPane=e.find(".tab-pane.active"),t.prop("classList").contains("dropdown-toggle")&&(t=t.closest("li").find("div a.active"),i=t.attr("href")),i=i.substring(1,i.length),s=`${ADMIN_URL}${i}${TABLE_LINE}`}const l=i.find("input, textarea, select").not(".line"),r=i.find("small");for(let e=0;e<l.length;e++)""!==l[e].name&&i.find("input:checkbox[name="+l[e].name+"], select[name="+l[e].name+"]").removeAttr("disabled");let d=new FormData(i[0]);$.ajax({url:s,type:"POST",data:d,processData:!1,contentType:!1,cache:!1,dataType:"JSON",beforeSend:function(){$(".close_form").attr("disabled",!0),$(".save_form").attr("disabled",!0),$(e).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'+o).prop("disabled",!0);for(let e=0;e<fieldReadOnly.length;e++)i.find("input:checkbox[name="+fieldReadOnly[e]+"], select[name="+fieldReadOnly[e]+"]").attr("disabled",!0)},complete:function(){$(".close_form").removeAttr("disabled"),$(".save_form").removeAttr("disabled"),$(e).html(t).prop("disabled",!1)},success:function(e){if(e[0].error)errorForm(i,e);else{_tableLine.row.add(e).draw(!1);for(let e=0;e<l.length;e++)""!==l[e].name&&i.find("input:checkbox[name="+l[e].name+"], select[name="+l[e].name+"]").closest(".form-group").removeClass("has-error");for(let e=0;e<r.length;e++)""!==r[e].id&&i.find("small[id="+r[e].id+"]").html("")}},error:function(e,t){showError(e,t)}})}else s[0].success&&"N"==s[0].message?Toast.fire({type:"warning",title:"You are role don't have permission !!"}):Toast.fire({type:"error",title:s[0].message})}),$(".create_line").click(function(e){let t="create",a=isAccess(t,LAST_URL),n=$(this).closest("form");if(a[0].success&&"Y"==a[0].message){let e=$(this),t=e.html(),a=e.text().trim(),i="N";n.find('input:checkbox[name="isinternaluse"]').is(":checked")&&(i="Y"),$(e).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'+a).prop("disabled",!0),setTimeout(function(){$(e).html(t).prop("disabled",!1),$("#modal_product_info").modal({backdrop:"static",keyboard:!1}),loadingForm("product_info","ios"),$("#modal_product_info").on("shown.bs.modal",function(e){e.preventDefault();const t=$(e.target),a=t.find("form");let n=ADMIN_URL+"product/showProductInfo/?data=null";a[0].reset(),setTimeout(function(){if(hideLoadingForm("product_info"),a.find("select.select-data").length>0){let e=a.find("select.select-data");initSelectData(e)}a.find('input:hidden[name="isfree"]')&&a.find('input:hidden[name="isfree"]').val(i),_tableInfo.ajax.url(n).load().columns.adjust()},50)})},100)}else a[0].success&&"N"==a[0].message?Toast.fire({type:"warning",title:"You are role don't have permission !!"}):Toast.fire({type:"error",title:a[0].message})}),$("#modal_product_info").on("hidden.bs.modal",function(e){const t=$(e.target),a=t.find("form");a[0].reset(),_tableInfo.clear().draw()}),$("#form_product_info").on("keypress",function(e){let t=e.keyCode||e.which;if(13===t)return e.preventDefault(),!1}),$(".btn_requery_info").click(function(e){const t=$(e.target),a=t.closest(".modal-content"),n=a.find("form");let i=ADMIN_URL+"product/showProductInfo/?",o=n.serialize();$(this).tooltip("hide"),_tableInfo.ajax.url(i+o).load().columns.adjust()}),$(".btn_save_info").click(function(e){const t=$(this).closest(".modal"),a=t.find(".modal-body"),n=_tableInfo.rows().nodes().to$().find('input:checkbox[name="check_data"]:checked');let i=$(this),o=i.html();if(n.length>0){let e=CURRENT_URL+TABLE_LINE+CREATE,s=[];$.each(n,function(e){let t=$(this).closest("tr"),a=t.find("input, select"),n=[];$.each(a,function(e,t){let a=[],i=$(t).attr("name"),o=$(t).val();a="checkbox"!==$(t).attr("type")?{[i]:o}:"check_data"===i?{product_id:o}:{[i]:$(t).is(":checked")},n.push(a)}),s[e]=n});let l=JSON.stringify(s);$.ajax({url:e,type:"POST",data:{data:l},cache:!1,dataType:"JSON",beforeSend:function(){$(i).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>').prop("disabled",!0),$(".btn_requery_info").attr("disabled",!0),$(".btn_close_info").attr("disabled",!0),loadingForm(a.attr("id"),"ios")},complete:function(){$(i).html(o).prop("disabled",!1),$(".btn_requery_info").removeAttr("disabled"),$(".btn_close_info").removeAttr("disabled"),hideLoadingForm(a.attr("id"))},success:function(e){$("#"+t.attr("id")).modal("hide"),_tableLine.rows.add(e).draw(!1)},error:function(e,t){showError(e,t)}})}else Toast.fire({type:"warning",title:"Please selected data !!"})}),$(".btn_ok_form").on("click",function(e){const t=$(e.target),a=t.closest(".page-inner"),n=t.closest(".card"),i=a.find(".card-table-report"),o=i.find(".float-right"),s=n.find("form"),l=s.find("[disabled]"),r=$(".ischeckall");l.removeAttr("disabled");let d=s.find("input, select").map(function(){if(void 0!==$(this).attr("name")){let e={};return e.name=$(this).attr("name"),"checkbox"!==this.type&&"select-multiple"!==this.type?e.value=this.value:"select-multiple"===this.type?e.value=$(this).val():e.value=this.checked?"Y":"N",e.type=this.type,e}}).get();formReport=d,l.prop("disabled",!0),clear=!1,o.removeClass("d-none"),a.length&&(a.addClass("is-loading"),reloadTable(),setTimeout(function(){r.prop("checked",!0),a.removeClass("is-loading")},700)),i.addClass("d-block");let c={buttons:[{extend:"colvis",className:"btn btn-primary btn-sm btn-round ml-auto text-white",text:'<i class="fas fa-table fa-fw"></i> Visibility',attr:{title:"Column Visibility"}},{extend:"collection",className:"btn btn-warning btn-sm btn-round ml-auto text-white mr-1",text:'<i class="fas fa-download fa-fw"></i> Export',attr:{title:"Export"},autoClose:!0,buttons:[{extend:"excelHtml5",text:'<i class="fas fa-file-excel"></i> Export',titleAttr:"Export to Excel",title:"",customize:function(e){var t=e.xl.worksheets["sheet1.xml"];$("row:first c",t).attr("s","27"),$("row:not(:first) c",t).attr("s","25")},exportOptions:{columns:":visible"}}]}]};new $.fn.dataTable.Buttons(_tableReport,c),_tableReport.buttons().container().appendTo($("#dt-button")),0==r.length&&$(".btn_print_qrcode").hide()}),$(".btn_reset_form").on("click",function(e){const t=$(e.target),a=t.closest(".page-inner"),n=t.closest(".card"),i=a.find(".card-table-report"),o=i.find(".float-right"),s=n.find("form"),l=s.find("input, select");for(let e=0;e<l.length;e++)""!==l[e].name&&(l[e].readOnly||l[e].disabled)&&fieldReadOnly.push(l[e].name);clearForm(e),clear=!0,o.addClass("d-none"),a.length&&(a.addClass("is-loading"),reloadTable(),setTimeout(function(){a.removeClass("is-loading")},500)),i.removeClass("d-block")}),$(".btn_login").click(function(){let e=$(this),t=e.html();const a=$(this).closest("form");let n=CURRENT_URL+"/login";$.ajax({url:n,type:"POST",data:a.serialize(),cache:!1,dataType:"JSON",beforeSend:function(){$(this).prop("disabled",!0),$(e).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>').prop("disabled",!0)},complete:function(){$(this).removeAttr("disabled"),$(e).html(t).prop("disabled",!1)},success:function(e){e[0].success?(Toast.fire({type:"success",title:e[0].message}),window.open(ADMIN_URL,"_self")):e[0].error?errorForm(a,e):Toast.fire({type:"error",title:e[0].message})},error:function(e,t){showError(e,t)}})}),$(".login-form input").keypress(function(e){let t=e.which;13==t&&$(".btn_login").click()}),$(".change-password").click(function(e){ID=$(this).attr("id"),openModalForm()}),$(".save_form_pass").click(function(e){const t=$(e.target).closest(".modal"),a=t.find("form");let n=$(this),i=n.html(),o=ADMIN_URL+"auth/changePassword",s=new FormData(a[0]);void 0!==ID&&""!==ID&&s.append("id",ID),$.ajax({url:o,type:"POST",data:s,processData:!1,contentType:!1,cache:!1,dataType:"JSON",beforeSend:function(){$(".close").prop("disabled",!0),loadingForm(a.prop("id"),"facebook"),$(n).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>').prop("disabled",!0)},complete:function(){$(".close").prop("disabled",!1),hideLoadingForm(a.prop("id")),$(n).html(i).prop("disabled",!1)},success:function(t){if(t[0].success)Toast.fire({type:"success",title:t[0].message}),clearForm(e),$(".modal_form").modal("hide");else if(t[0].error){let e=t[0].message;$.each(e,function(e,t){""!==t?(a.find('input:password[name="'+e+'"]').closest(".form-group").addClass("has-error"),a.find("small[id=error_"+e+"]").html(t)):(a.find('input:password[name="'+e+'"]').closest(".form-group").removeClass("has-error"),a.find("small[id=error_"+e+"]").html(""))})}else Toast.fire({type:"error",title:t[0].message})},error:function(e,t){showError(e,t)}})}),$("input.active:checkbox").change(function(e){const t=$(this).closest("form"),a=t.find("input, textarea, select, button");let n;if(fieldReadOnly=[...new Set(fieldReadOnly)],$(this).is(":checked"))for(let e=0;e<a.length;e++)""!==a[e].name&&(n=a[e].className.split(/\s+/),fieldReadOnly.includes(a[e].name)||void 0!==$(a[e]).attr("edit-readonly")||t.find("input:text[name="+a[e].name+"], textarea[name="+a[e].name+"], input:password[name="+a[e].name+"]").not(".line").removeAttr("readonly"),n.includes("active")||fieldReadOnly.includes(a[e].name)||void 0!==$(a[e]).attr("edit-disabled")||(t.find("input:checkbox[name="+a[e].name+"], input:radio[name="+a[e].name+"], select[name="+a[e].name+"], button[name="+a[e].name+"]").not(".line").removeAttr("disabled"),"file"===a[e].type&&(t.find("input[name="+a[e].name+"]").removeAttr("disabled"),t.find("button.close-img").removeAttr("disabled").css("display","block"))),t.find("textarea.summernote[name="+a[e].name+"]").length&&t.find("[name ="+a[e].name+"]").summernote("enable"));else for(let e=0;e<a.length;e++)""!==a[e].name&&(n=a[e].className.split(/\s+/),(a[e].readOnly||a[e].disabled)&&"radio"!==a[e].type&&fieldReadOnly.push(a[e].name),fieldReadOnly.includes(a[e].name)||t.find("input:text[name="+a[e].name+"], textarea[name="+a[e].name+"], input:password[name="+a[e].name+"]").not(".line").prop("readonly",!0),n.includes("active")||fieldReadOnly.includes(a[e].name)||(t.find("input:checkbox[name="+a[e].name+"], input:radio[name="+a[e].name+"], select[name="+a[e].name+"], button[name="+a[e].name+"]").not(".line").prop("disabled",!0),"file"===a[e].type&&(t.find("input[name="+a[e].name+"]").prop("disabled",!0),t.find("button.close-img").prop("disabled",!0).css("display","none"))),t.find("textarea.summernote[name="+a[e].name+"]").length&&t.find("[name ="+a[e].name+"]").summernote("disable"))}),$(".close-img").click(function(e){const t=$(e.currentTarget).closest("div"),a=t.closest(".form-group"),n=a.find(".form-upload"),i=$(e.currentTarget).closest("form"),o=i.find("input");let s=t.find("label").prop("className");if(s.includes("form-result")){n.find("label").css("display","block"),t.find("label").css("display","none"),n.find("input:file").val(""),t.find(".img-result").attr("src","");for(let e=0;e<o.length;e++)""!==o[e].name&&"file"===o[e].type&&(i.find("input[name="+o[e].name+"]").removeAttr("disabled"),t.find("button.close-img").removeAttr("disabled").css("display","block"))}});const capitalize=e=>"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1);$(document).on("click","input:checkbox",function(){const e=$(this).closest("table"),t=$(this).closest("tr");let a,n=$(this).closest("th").index(),i=$(this).parent().parent().parent().index(),o=i+1;$(this).is(":checked")?(n>0&&e.find("td:nth-child("+o+") input:checkbox").prop("checked",!0),(t.hasClass("treetable-expanded")||t.hasClass("treetable-collapsed"))&&(a=t.attr("data-node").substring(10),e.find("tr[data-pnode=treetable-parent-"+a+"] td:nth-child("+o+") input:checkbox").prop("checked",!0))):(n>0&&e.find("td:nth-child("+o+") input:checkbox").prop("checked",!1),(t.hasClass("treetable-expanded")||t.hasClass("treetable-collapsed"))&&(a=t.attr("data-node").substring(10),e.find("tr[data-pnode=treetable-parent-"+a+"] td:nth-child("+o+") input:checkbox").prop("checked",!1)))}),_tableLine.on("change","input.active:checkbox",function(e){const t=$(this).closest("tr"),a=t.find("input, select");let n;if($(this).is(":checked"))for(let e=0;e<a.length;e++)""!==a[e].name&&(n=a[e].className.split(/\s+/),t.find("input:text[name="+a[e].name+"]").removeAttr("readonly"),"text"===a[e].type||n.includes("active")||t.find("input[name="+a[e].name+"], select[name="+a[e].name+"]").removeAttr("disabled"));else for(let e=0;e<a.length;e++)""!==a[e].name&&(n=a[e].className.split(/\s+/),t.find("input:text[name="+a[e].name+"]").prop("readonly",!0),"text"===a[e].type||n.includes("active")||t.find("input[name="+a[e].name+"], select[name="+a[e].name+"]").prop("disabled",!0))}),$(".toggle-sidebar").click(function(e){$(".dataTables_scrollHeadInner").addClass("stretch"),$(".tb_display, .table_report").css("width","100%")}),$("#task_activity").click(function(e){e.preventDefault(),$("#modal_activity_info").modal({backdrop:"static",keyboard:!1}),$("#modal_activity_info").on("shown.bs.modal",function(e){const t=$(e.target),a=t.find("form");let n=ADMIN_URL+"wactivity/showActivityInfo";a.find("input").prop("readonly",!0),a.find('select[name="isanswer"]').hide(),
a.find("button").prop("disabled",!0),setTimeout(function(){_tableApproval.ajax.url(n).load().columns.adjust()},50)})}),$(".table_approval tbody").on("click","tr",function(){const e=$(this).closest(".modal-body"),t=e.find("form");if($(this).hasClass("selected"))$(this).removeClass("selected"),ID=0,t.find("input").prop("readonly",!0),t.find('select[name="isanswer"]').val("N").prop("disabled",!0),t.find("button").prop("disabled",!0);else{_tableApproval.$("tr.selected").removeClass("selected"),$(this).addClass("selected");let e=_tableApproval.row(this).data();void 0!==e&&(ID=e[0],t.find("input").removeAttr("readonly"),t.find('select[name="isanswer"]').val("N").removeAttr("disabled").show(),t.find("button").removeAttr("disabled"))}}),$(".btn_ok_answer").click(function(e){e.preventDefault();let t=$(this),a=t.html();const n=t.closest(".modal-body"),i=t.closest("form");let o=new FormData(i[0]),s=ADMIN_URL+"wactivity"+CREATE;o.append("record_id",ID),$.ajax({url:s,type:"POST",data:o,processData:!1,contentType:!1,cache:!1,dataType:"JSON",beforeSend:function(){$(t).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>').prop("disabled",!0),loadingForm(n.prop("id"),"facebook")},complete:function(){$(t).html(a).prop("disabled",!1),hideLoadingForm(n.prop("id"))},success:function(e){e&&(ID=0,i.find("input").prop("readonly",!0),i.find('select[name="isanswer"]').val("N").prop("disabled",!0),i.find("button").prop("disabled",!0),s=ADMIN_URL+"wactivity/showActivityInfo",_tableApproval.ajax.url(s).load().columns.adjust())}})}),$(".btn_record_info").click(function(e){const t=_tableApproval.$("tr.selected"),a=t.find("td"),n=_tableApproval.row(a).data();ID=n[0];let i=n[1],o=n[2],s=n[3],l={id:ID,record_id:i,table:o,menu:s};l=JSON.stringify(l),sessionStorage.setItem("reloading","true"),sessionStorage.setItem("data",l),window.open(ADMIN_URL+s,"_self")}),window.onload=function(){let e=sessionStorage.getItem("reloading"),t=JSON.parse(sessionStorage.getItem("data"));e&&(sessionStorage.removeItem("reloading"),Edit(t.record_id,"IP",t.menu))},$(".ischeckall").click(function(e){const t=$(e.target),a=t.closest(".card-table-report"),n=a.find(".float-right"),i=_tableReport.rows().nodes().to$().find("input.check-data");this.checked?($.each(i,function(e){$(this).prop("checked",!0)}),n.removeClass("d-none")):($.each(i,function(e){$(this).prop("checked",!1)}),n.addClass("d-none"))}),_tableReport.on("click",".check-data",function(e){const t=$(e.target),a=t.closest(".card-table-report"),n=a.find(".float-right"),i=_tableReport.rows().nodes().to$().find("input.check-data");if($(this).is(":checked")){let e=[];$.each(i,function(t,a){$(a).is(":checked")||e.push(a.value)}),n.removeClass("d-none"),0==e.length&&$(".ischeckall").prop("checked",!0)}else{let e=[];$.each(i,function(t,a){$(a).is(":checked")&&e.push(a.value)}),0==e.length&&n.addClass("d-none"),$(".ischeckall").prop("checked",!1)}}),$(".btn_print_qrcode").on("click",function(e){let t=$(this),a=t.html(),n=t.text().trim(),i=new FormData,o=_tableReport.rows().nodes().to$().find("input.check-data:checked"),s=[];$.each(o,function(e,t){s.push(t.value)}),i.append("assetcode",JSON.stringify(s)),$.ajax({url:CURRENT_URL+"/print",type:"POST",data:i,processData:!1,contentType:!1,cache:!1,dataType:"JSON",beforeSend:function(){$(t).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'+n).prop("disabled",!0),$(".btn_ok_form").prop("disabled",!0),$(".btn_reset_form").prop("disabled",!0)},complete:function(){$(t).html(a).prop("disabled",!1),$(".btn_ok_form").removeAttr("disabled"),$(".btn_reset_form").removeAttr("disabled")},success:function(e){downloadFile(e)}})}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){const t=$(e.target),a=t.closest(".modal"),n=a.find(".tab-pane.active"),i=n.find("form"),o=i.find("table.tb_displaytab"),s=i.find("input.foreignkey");let l=t.attr("href"),r=[],d=n.attr("set-id");l=l.substring(1,l.length),changeTab=!0;let c=`${ADMIN_URL}${l}${SHOW}${d}`,f=o.attr("id");o.length>1&&(f=$(o[1]).attr("id")),o.length&&(_tableLine.destroy(),_tableLine=i.find(`#${f}`).DataTable({drawCallback:function(e){$(this).find(".number").on("keypress keyup blur",function(e){$(this).val($(this).val().replace(/[^\d-].+/,"")),(e.which<48&&45!=e.which||e.which>57&&189!=e.which)&&e.preventDefault()}),$(this).find(".select2").select2({placeholder:"Select an option",theme:"bootstrap",allowClear:!0}),$(this).find(".datepicker").datepicker({format:"dd-M-yyyy",autoclose:!0,clearBtn:!0,todayHighlight:!0,todayBtn:!0}),$(this).find(".yearpicker").datepicker({format:"yyyy",viewMode:"years",minViewMode:"years",autoclose:!0,clearBtn:!0})},columnDefs:[{targets:0,visible:!1}],lengthChange:!1,pageLength:10,searching:!1,ordering:!1,autoWidth:!1,scrollX:!0,scrollY:"50vh",scrollCollapse:!0}));const m=i.find("input, textarea, select").not(".line");for(let e=0;e<m.length;e++){let t=[];if(""!==m[e].name){if("checkbox"==m[e].type&&fieldChecked.includes(m[e].name)&&i.find("input:checkbox[name="+m[e].name+"]").prop("checked",!0),$(m[e]).attr("hide-field"))if(t=$(m[e]).attr("hide-field").split(",").map(e=>e.trim()),"checkbox"===m[e].type)if(m[e].checked)for(let e=0;e<t.length;e++){let a=i.find("input[name="+t[e]+"], textarea[name="+t[e]+"], select[name="+t[e]+"]").closest(".form-group, .form-check");a.hide()}else for(let e=0;e<t.length;e++){let a=i.find("input[name="+t[e]+"], textarea[name="+t[e]+"], select[name="+t[e]+"]").closest(".form-group, .form-check");a.show()}else for(let e=0;e<t.length;e++){let a=i.find("input[name="+t[e]+"], textarea[name="+t[e]+"], select[name="+t[e]+"]").closest(".form-group, .form-check");a.hide()}if($(m[e]).attr("show-field"))if(t=$(m[e]).attr("show-field").split(",").map(e=>e.trim()),"checkbox"===m[e].type){if(m[e].checked)for(let e=0;e<t.length;e++){let a=i.find("input[name="+t[e]+"], textarea[name="+t[e]+"], select[name="+t[e]+"]").closest(".form-group, .form-check");a.show()}else if("checkbox"===m[e].type)for(let e=0;e<t.length;e++){let a=i.find("input[name="+t[e]+"], textarea[name="+t[e]+"], select[name="+t[e]+"]").closest(".form-group, .form-check");a.hide()}}else for(let e=0;e<t.length;e++){let a=i.find("input[name="+t[e]+"], textarea[name="+t[e]+"], select[name="+t[e]+"]").closest(".form-group, .form-check");a.show()}}}if(s.length){d=s.attr("set-id");const e="/show";c=`${ADMIN_URL}${l}${e}`,r={[s.attr("name")]:d}}$.ajax({url:c,type:"GET",data:r,cache:!1,dataType:"JSON",beforeSend:function(){$(".save_form").prop("disabled",!0),$(".close_form").prop("disabled",!0),loadingForm(i.prop("id"),"ios")},complete:function(){$(".save_form").removeAttr("disabled"),$(".close_form").removeAttr("disabled"),hideLoadingForm(i.prop("id"))},success:function(t){if(t[0].success){let a=t[0].message;if(a.line){let e=a.line;if(_tableLine.context.length){_tableLine.clear().draw();let t=JSON.parse(e);_tableLine.rows.add(t).draw(!1)}}if(a.header){let e=a.header;putFieldData(i,e);for(let t=0;t<e.length;t++){e[t].field;let a=e[t].label,i=e[t].primarykey;i&&(ID=a,n.attr("set-save","update"))}}else clearForm(e),i.find('input[type="checkbox"].active').length&&i.find('input[type="checkbox"].active').prop("checked",!0);s.length&&(c=s.attr("data-url"),showForeignKey(c,d,s))}else Toast.fire({type:"error",title:t[0].message})},error:function(e,t){showError(e,t)}})});